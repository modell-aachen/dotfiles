qeycloak() {
    _usage() {
        cat << USAGE
qeycloak [command]

Available Commands:
  create            creates a java truststore in current directory
    <store_name>    full name of the resulting truststore ending with .jks
  import            creates and imports a certificate
    <store_name>    full name of the resulting truststore ending with .jks
    <LDAP-FQDN>     LDAP FQDN (Example: ldap.int.modac.eu)

Flags:
  -h, --help        shows this help message

USAGE
    }

    _createStore() {
        local store=$1

        keytool -genkey -alias localhost -keyalg RSA -keystore $store -validity 10950
    }

    _importCertificate() {
        local store=$1
        local ldap=$2

        openssl s_client -connect $ldap:636 -showcerts >> crtTmp.cer
        keytool -import -alias $ldap -file crtTmp.cer -keystore $store
        rm crtTmp.cer
    }

    OPTS=`getopt -o h --long help -- "$@"`
    if [ $? != 0 ] ; then echo "Failed parsing options." >&2 ; return 1 ; fi

    eval set -- "$OPTS"

    while true; do
        case "$1" in
            -h | --help )
                _usage
                return ;;
            -- )
                shift
                break ;;
            * )
                break ;;
        esac
    done

    shift $(expr $OPTIND - 1 )
    local subcommand=$1
    shift
    local args=$@

    case "$subcommand" in
        create )
            _createStore $args
            return
            ;;
        import )
            _importCertificate $args
            return
            ;;
    esac
}

_qeycloak-completion() {
    local cur="${COMP_WORDS[COMP_CWORD]}"

    case ${COMP_CWORD} in
        1)
            COMPREPLY=($(compgen -W "create import --help" -- $cur))
            ;;
        2)
            local subcommand=${COMP_WORDS[1]}
            case $subcommand in
                create )
                    COMPREPLY=($(compgen -W "keycloak.jks" -- $cur))
                    ;;
                import )
                    COMPREPLY=($(compgen -W "keycloak.jks" -- $cur))
                    ;;
            esac
            ;;
    esac
}

complete -F _qeycloak-completion qeycloak
