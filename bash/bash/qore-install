qore-install() {
    local user=www-data

    qwiki-files() {
    find $CORE_REPO/{bin,cron,data,lib,LICENSE,locale,pub,README.md,resources,robots.txt,solr,templates,tools,WebService-Solr.patch,working} \
        -type f ! -path "$CORE_REPO/pub/System/js/*" \
        | sed "s#^$CORE_REPO##"
    }

    qore-link() {
        local file=$1
        local fullpath=$2
        local dest=${file/$CORE_REPO/$FOSWIKI_ROOT}

        if [ -L "$dest" ]; then
            return
        fi

        if [ ! -f "$dest"  ]; then
            sudo -u $user mkdir -p $(dirname "$dest")
            sudo -u $user cp -r "$file" "$dest"
        fi
        sudo -u $user ln -sf "$file" "$dest"
    }

    qore-link-frontend() {
        local file="$CORE_REPO/pub/System/js"
        local dest="$FOSWIKI_ROOT/pub/System/js"

        sudo rm -r "$dest"
        sudo -u $user ln -s "$file" "$dest"
    }

    qore-link-frontend

    local files="$(qwiki-files)"
    OIFS="$IFS"
    IFS=$'\n'
    for file in $files; do
        echo "$file"
        local fullpath="$CORE_REPO/$file"
        qore-link "$fullpath" "$fullpath"
    done
    IFS="$OIFS"

    sudo systemctl restart qwikiRestart
    echo "Success!"
}
